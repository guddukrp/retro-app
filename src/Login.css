/* // Login.tsx
import { useState, useEffect } from "react";
import { supabase } from "./services/supabaseClient";

export default function Login() {
    const [email, setEmail] = useState("");
    const [loading, setLoading] = useState(false);
    const [session, setSession] = useState<any>(null);
    const [verifying, setVerifying] = useState(false);
    const [authError, setAuthError] = useState<string | null>(null);
    const [authSuccess, setAuthSuccess] = useState(false);

    // --------------------------
    // Check URL for token_hash (magic link callback)
    // --------------------------
    useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const token_hash = params.get("token_hash");
        const rawType = params.get("type") || "email";

        // Allowed types based on your Supabase version
        type SupabaseOtpType = "email" | "magiclink";

        // Normalize incorrect values
        const supabaseType: SupabaseOtpType =
            rawType === "magiclink" ? "magiclink" : "email";

        if (token_hash) {
            setVerifying(true);

            supabase.auth.verifyOtp({
                token_hash,
                type: supabaseType,
            }).then(({ error }) => {
                if (error) {
                    setAuthError(error.message);
                } else {
                    setAuthSuccess(true);
                    window.history.replaceState({}, document.title, "/");
                }
                setVerifying(false);
            });
        }


        // --------------------------
        // Get active session
        // --------------------------
        supabase.auth.getSession().then(({ data: { session } }) => {
            setSession(session);
        });

        // --------------------------
        // Subscribe for auth changes
        // --------------------------
        const { data: subscription } = supabase.auth.onAuthStateChange(
            (_event, session) => {
                setSession(session);
            }
        );

        return () => {
            subscription.subscription.unsubscribe();
        };
    }, []);

    // --------------------------
    // Login handler
    // --------------------------
    const handleLogin = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);

        const { error } = await supabase.auth.signInWithOtp({
            email,
            options: { emailRedirectTo: window.location.origin },
        });

        if (error) alert(error.message);
        else alert("Check your email for the login link!");

        setLoading(false);
    };

    const handleLogout = async () => {
        await supabase.auth.signOut();
        setSession(null);
    };

    // --------------------------
    // UI Render Logic
    // --------------------------

    if (verifying) {
        return (
            <div>
                <h2>Verifying magic link...</h2>
                <p>Please wait...</p>
            </div>
        );
    }

    if (authError) {
        return (
            <div>
                <h2>Authentication Failed</h2>
                <p>{authError}</p>
                <button onClick={() => setAuthError(null)}>Try again</button>
            </div>
        );
    }

    if (authSuccess && !session) {
        return (
            <div>
                <h2>Login Successful!</h2>
                <p>Loading your session...</p>
            </div>
        );
    }

    if (session) {
        return (
            <div>
                <h2>Welcome!</h2>
                <p>You are logged in as: {session.user.email}</p>
                <button onClick={handleLogout}>Logout</button>
            </div>
        );
    }

    return (
        <div>
            <h2>Login</h2>
            <p>Enter your email to receive a magic link</p>

            <form onSubmit={handleLogin}>
                <input
                    type="email"
                    required
                    placeholder="Email address"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                />

                <button disabled={loading}>
                    {loading ? "Sending…" : "Send Magic Link"}
                </button>
            </form>
        </div>
    );
} */



/* 
{id: 'fe1963c8-02f4-4cda-9801-0395e173c705', aud: 'authenticated', role: 'authenticated', email: 'guddukp11@gmail.com', email_confirmed_at: '2025-12-08T06:19:23.724442Z', …}
app_metadata
: 
{provider: 'email', providers: Array(2)}
aud
: 
"authenticated"
confirmation_sent_at
: 
"2025-12-08T06:19:04.069224Z"
confirmed_at
: 
"2025-12-08T06:19:23.724442Z"
created_at
: 
"2025-12-08T06:19:04.04338Z"
email
: 
"guddukp11@gmail.com"
email_confirmed_at
: 
"2025-12-08T06:19:23.724442Z"
id
: 
"fe1963c8-02f4-4cda-9801-0395e173c705"
identities
: 
(2) [{…}, {…}]
is_anonymous
: 
false
last_sign_in_at
: 
"2025-12-08T06:54:19.291469Z"
phone
: 
""
role
: 
"authenticated"
updated_at
: 
"2025-12-08T06:54:19.29445Z"
user_metadata
: 
{avatar_url: 'https://lh3.googleusercontent.com/a/ACg8ocJrfCMVu9dfkVqtxOeTysohb2D2mwqaXGNGX4c4KTaZb9Oxfr4=s96-c', email: 'guddukp11@gmail.com', email_verified: true, full_name: 'Guddu Kumar', iss: 'https://accounts.google.com', …}
[[Prototype]]
: 
Object */